---
name: Table
path: /Table
menu: Table
---

import { Playground, PropsTable } from 'docz';
import Table from '../Table';
import TableBase from '../TableBase';
import ModalButton from '../../ModalButton';
import Form from '../../Form';
import { delay, mockData } from '../@/tools';
import { Button } from 'antd';

# Table

封装 ag-grid

## Render

请注意 render 只会在初始化 cell 时候渲染一次，如果要改变内部状态，请封装成组件，内部自己维护自身状态；或者强制调用 refreshView

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                text: '777',
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    {
                        headerName: 'Price',
                        field: 'price',
                        render: (params) => {
                            return <ModalButton content={<Form footer={false} controls={[{
                                control: {
                                    label: 'name'
                                },
                                field: 'name'
                            }]}></Form>}>click me{this.state.text}</ModalButton>
                        }
                     },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <>
            <Button style={{marginBottom: 12}} onClick={() => this.setState({ text: '666' }, () => {
                
                this.$table.$baseTable.gridApi.refreshView()
            })}>change text and refresh view</Button>
            <Table ref={node => this.$table = node } rowKey="make" columnDefs={columnDefs} rowData={rowData} />
            </>
        }
    }

    return <Demo />

}}

</Playground>

## 列头可拖动宽度

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table enableColResize rowKey="make" columnDefs={columnDefs} rowData={rowData} />
        }
    }

    return <Demo />

}}

</Playground>

## 过滤行内容

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table enableFilter rowKey="make" columnDefs={columnDefs} rowData={rowData} />
        }
    }

    return <Demo />

}}

</Playground>

## 范围单元格选择

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table enableRangeSelection rowKey="make" columnDefs={columnDefs} rowData={rowData} />
        }
    }

    return <Demo />

}}

</Playground>

## 排序

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table enableSorting rowKey="make" columnDefs={columnDefs} rowData={rowData} />
        }
    }

    return <Demo />

}}

</Playground>

## 分组

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', type: 'dimension' },
                    { headerName: 'Model', field: 'model', type: 'dimension' },
                    { headerName: 'Price', field: 'price', type: 'dimension' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table
                        rowGroupPanelShow="always"
                        columnTypes={{
                            dimension: {
                                enableRowGroup: true,
                            },
                        }}
                        rowKey="make"
                        columnDefs={columnDefs}
                        rowData={rowData}
                    />
        }
    }

    return <Demo />

}}

</Playground>

## 行选择

如果没有传递 `rowMultiSelectWithClick`，多选需要同时按住 `shift`。

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', type: 'dimension' },
                    { headerName: 'Model', field: 'model', type: 'dimension' },
                    { headerName: 'Price', field: 'price', type: 'dimension' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };

            this.onSwitchMode = this.onSwitchMode.bind(this)
        }

        onSwitchMode() {
            this.setState({
                rowSelection: this.state.rowSelection === 'multiple' ? 'single' : 'multiple'
            })
        }

        render () {
            const { columnDefs, rowData } = this.state;
            const ButtonGroup = Button.Group;
            return <>
                <ButtonGroup style={{ marginBottom: 10 }}>
                    <Button type='primary' onClick={this.onSwitchMode}>{this.state.rowSelection === 'multiple' ? '单选' : '多选'}</Button>
                </ButtonGroup>
                <Table
                    rowMultiSelectWithClick
                    rowSelection={this.state.rowSelection}
                    rowKey="make"
                    columnDefs={columnDefs}
                    rowData={rowData}
                />
            </>
        }
    }

    return <Demo />

}}

</Playground>

## 分页

### 前端分页

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make' },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData:  mockData(
                    {
                        make: '@name',
                        model: '@name',
                        price: '@integer',
                    },
                    '30-50'
                ),
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table
                        rowKey="make"
                        columnDefs={columnDefs}
                        rowData={rowData}
                    />
        }
    }

    return <Demo />

}}

</Playground>

### 后端分页

后端分页需要指定 `paginationProps.backend` ，table 内部就不会去 `slice dataSource`

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make' },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [],
                pagination: {
                    current: 1,
                    pageSize: 10,
                }
            };
            this.search = this.search.bind(this)
            this.onPaginationChange = this.onPaginationChange.bind(this)
        }

        componentDidMount() {
            this.search()
        }

        onPaginationChange({ pagination }) {
            this.setState({
                pagination,
            })
            this.search()
        }

        search() {
            this.setState({
                loading: true,
            })
            delay(1000, mockData(
                    {
                        make: '@name',
                        model: '@name',
                        price: '@integer',
                    },
                    '10'
            )).then(rowData => {
                this.setState({
                    rowData,
                    loading: false,
                    pagination: {
                        ...this.state.pagination,
                        total: 30,
                    }
                })
            })
        }

        render () {
            const { columnDefs, rowData, loading } = this.state;
            return <Table
                        loading={this.state.loading}
                        rowKey="make"
                        columnDefs={columnDefs}
                        rowData={rowData}
                        paginationProps={{
                            backend: true,
                        }}
                        pagination={this.state.pagination}
                        onPaginationChange={this.onPaginationChange}
                        onPaginationShowSizeChange={this.onPaginationChange}
                    />
        }
    }

    return <Demo />

}}

</Playground>

## 单元格验证

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    {
                        headerName: 'Price',
                        field: 'price',
                        editable: true,
                        rules: [
                            {
                                required: true,
                                message: '必填',
                            },
                            {
                                message: '需要大于1000',
                                validator: (rule, value, callback) => {
                                    if (value < 1000) {
                                        return callback(true)
                                    }
                                    callback()
                                }
                            }
                        ],
                    },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 0 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };

            this.onClick = this.onClick.bind(this)
        }

        onClick() {
            this.$table.$baseTable.validateTableCells().then(results => {
                if (results.some(item => item.error)) {
                   
                   return alert('has error');
                }
                alert('success!')
            });
        };

        render () {
            const { columnDefs, rowData } = this.state;
            return <>
                    <Button type='primary' onClick={this.onClick} style={{marginBottom: 10}}>验证</Button>
                    <Table ref={node => this.$table = node} rowKey="make" columnDefs={columnDefs} rowData={rowData} />
                </>
        }
    }

    return <Demo />

}}

</Playground>

## 编辑联动

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', editable: true },
                    {
                        headerName: 'Model',
                        field: 'model',
                        editable: true,
                        input: {
                            type: 'number',
                        },
                    },
                    {
                        headerName: 'Price',
                        field: 'price',
                        editable: true,
                        input: {
                            type: 'number'
                        },
                        getValue: {
                            depends: ['model'],
                            value: (data) => {
                                return new Promise(resolve => {
                                    setTimeout(() => {
                                        resolve(data.model);
                                    }, 3000);
                                });
                            }
                        }
                    },
                    {
                        headerName: 'Total',
                        field: 'total',
                        input: {
                            type: 'number'
                        },
                        getValue: {
                            depends: ['price', 'model'],
                            value: (data) => {
                                return new Promise(resolve => {
                                    setTimeout(() => {
                                        resolve(data.price + data.model);
                                    }, 1000);
                                });
                            }
                        }
                    },
                ],
                rowData: [
                    { make: 'Toyota', model: 123, price: 35000 },
                    { make: 'Ford', model: 123, price: 32000 },
                    { make: 'Porsche', model: 123, price: 72000 },
                ],
            };
        }

        render() {
            const { columnDefs, rowData } = this.state;
            return (
                <Table
                    rowKey="make"
                    columnDefs={columnDefs}
                    rowData={rowData}
                    ref={node => (this.table = node)}
                />
            );
        }
    }

    return <Demo />;

}}

</Playground>

## 验证联动

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    {
                        headerName: 'Make',
                        field: 'make',
                        editable: true,
                        input: {
                            type: 'number',
                        },
                        rules: [{
                            message: '必须比 0 小',
                            validator(rule, value, callback) {
                                if (value > 0) {
                                    callback(true)
                                }
                                callback()
                            }
                        }]
                    },
                    {
                        headerName: 'Model',
                        field: 'model',
                        editable: true,
                        input: {
                            type: 'number',
                        },
                        rules: record => {
                            return {
                                value: [{
                                    message: '必须比 make 小',
                                    validator(rule, value, callback) {
                                        if (value > record.make) {
                                            callback(true)
                                        }
                                        callback()
                                    }
                                }],
                                depends: ['make']
                            }
                        }
                    },
                    {
                        headerName: 'Price',
                        field: 'price',
                        editable: true,
                        input: {
                            type: 'number',
                        },

                        rules: record => {
                            return {
                                value: [{
                                    message: '必须比 model 小',
                                    validator(rule, value, callback) {
                                        if (value > record.model) {
                                            callback(true)
                                        }
                                        callback()
                                    }
                                }],
                                depends: ['model']
                            }
                        }
                    },
                ],
                rowData: [
                    { make: 0, model: 1, price: 35000 },
                    { make: 0, model: 1, price: 32000 },
                    { make: 0, model: 1, price: 72000 },
                ],
            };
        }

        render() {
            const { columnDefs, rowData } = this.state;
            return (
                <Table
                    rowKey="make"
                    columnDefs={columnDefs}
                    rowData={rowData}
                    ref={node => (this.table = node)}
                />
            );
        }
    }

    return <Demo />;

}}

</Playground>

## Input 联动

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    {
                        headerName: 'Make',
                        field: 'make',
                        editable: true,
                        input: {
                            type: 'number',
                        },
                    },
                    {
                        headerName: 'Model',
                        field: 'model',
                        editable: true,
                        input: record => ({
                            type: 'number',
                        }),
                    },
                    {
                        headerName: 'Price',
                        field: 'price',
                        editable: true,
                        input: record => {
                            if (record.model > 100) {
                                return {
                                    depends: ['model'],
                                    value: {
                                        type: 'number',
                                    }
                                }
                            } else {
                                return {
                                    depends: ['model'],
                                    value: {
                                        type: 'number',
                                        formatValue: val => val + '$'
                                    }
                                }
                            }
                        },
                    },
                ],
                rowData: [
                    { make: 0, model: 1, price: 35000 },
                    { make: 0, model: 1, price: 32000 },
                    { make: 0, model: 1, price: 72000 },
                ],
            };
        }

        render() {
            const { columnDefs, rowData } = this.state;
            return (
                <Table
                    rowKey="make"
                    columnDefs={columnDefs}
                    rowData={rowData}
                    ref={node => (this.table = node)}
                />
            );
        }
    }

    return <Demo />;

}}

</Playground>

## Exsitable 联动

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    {
                        headerName: 'Make',
                        field: 'make',
                        editable: true,
                        input: {
                            type: 'number',
                        },
                    },
                    {
                        headerName: 'Model',
                        field: 'model',
                        editable: true,
                        input: {
                            type: 'number',
                        },
                    },
                    {
                        headerName: 'Price',
                        field: 'price',
                        exsitable: params => {
                            if (params.data.model > 100) {
                                return {
                                    depends: ['model'],
                                    value: true
                                }
                            } else {
                                return {
                                    depends: ['model'],
                                    value: false
                                }
                            }
                        },
                    },
                ],
                rowData: [
                    { make: 0, model: 1, price: 35000 },
                    { make: 0, model: 1, price: 32000 },
                    { make: 0, model: 1, price: 72000 },
                ],
            };
        }

        render() {
            const { columnDefs, rowData } = this.state;
            return (
                <Table
                    rowKey="make"
                    columnDefs={columnDefs}
                    rowData={rowData}
                    ref={node => (this.table = node)}
                />
            );
        }
    }

    return <Demo />;

}}

</Playground>

## 纵向表格

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table vertical rowKey="make" columnDefs={columnDefs} rowData={rowData} />
        }
    }

    return <Demo />

}}

</Playground>

### 纵向表格综合

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make', },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                ],
                rowData: [
                    { make: 'Toyota', model: 'Celica', price: 35000 },
                    { make: 'Ford', model: 'Mondeo', price: 32000 },
                    { make: 'Porsche', model: 'Boxter', price: 72000 },
                ],
            };
        }

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table vertical rowKey="make" columnDefs={columnDefs} rowData={rowData} />
        }
    }

    return <Demo />

}}

</Playground>

## 热力图

<Playground>
{() => {

    class Demo extends React.PureComponent {
        constructor(props) {
            super(props);

            this.state = {
                columnDefs: [
                    { headerName: 'Make', field: 'make' },
                    { headerName: 'Model', field: 'model' },
                    { headerName: 'Price', field: 'price' },
                    { headerName: 'Price1', field: 'price1' },
                    { headerName: 'Price2', field: 'price2' },
                    { headerName: 'Price3', field: 'price3' },
                    { headerName: 'Price4', field: 'price4' },
                    { headerName: 'Price5', field: 'price5' },
                    { headerName: 'Price6', field: 'price6' },
                ],
                rowData: [],
            };
        }


          componentDidMount() {
            setInterval(() => {
                this.setState({
                    rowData: mockData(
                    {
                        make: '@integer(100, 110)',
                        model: '@integer(100, 110)',
                        price: '@integer(100, 110)',
                        price1: '@integer(100, 110)',
                        price2: '@integer(100, 110)',
                        price3: '@integer(100, 110)',
                        price4: '@integer(100, 110)',
                        price5: '@integer(100, 110)',
                        price6: '@integer(100, 110)',
                    },
                    '15-20'
                    ).map((item, index) => {
                        return {
                            ...item,
                            id: index + '',
                        };
                    }),
                });
            }, 3000);
        };

        render () {
            const { columnDefs, rowData } = this.state;
            return <Table
                unionId="demoheatmap"
                rowKey="id"
                columnDefs={columnDefs}
                rowData={rowData}
                defaultColDef={{
                    enableCellChangeFlash: false,
                    cellRenderer: 'HeatmapCellRenderer',
                }}
            />
        }
    }

    return <Demo />

}}

</Playground>

# API

<PropsTable of={Table} />
