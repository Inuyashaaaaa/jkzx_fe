<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>同余科技-衍生品交易管理后台</title>
  <meta name="keywords" content="智能资管，Fintech，创新互联网资管，量化对冲，风险控制，风险收益量化匹配 ，回测，交易平台，绩效分析，资管平台，数据支持，系统服务，产品 发行，资管产品设计">
  <meta name="description" content="上海同余信息科技有限公司 （Bachelier Technology），专注于金融与科技交叉领域的创新研发与投资管理。">
  <link rel="icon" href="/favicon.png" type="image/x-icon">
  <!-- <script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.data-set-0.9.6/dist/data-set.min.js"></script> -->
  <script src="<%= context.publicPath %>moment.min.js"></script>
  <script src="<%= context.publicPath %>jquery.min.js"></script>
  <script src="<%= context.publicPath %>mock.min.js"></script>
  <script src="<%= context.publicPath %>uuid.min.js"></script>
  <link rel="stylesheet" href="<%= context.publicPath %>animate.min.css">
</head>

<body>
  <div id="root"></div>
</body>

<script type='text/javascript'>
  (function(){
    let token = localStorage.getItem('tongyu_TOKEN_LOCAL_FIELD');
    let currentTime = new Date().getTime();
    let lastTime = parseInt( localStorage.getItem('last_unload_time') || 0 );
    let tokenValid = !!token;
    let href = window.location.href;
    let isPageLogin =  href.includes('user/login');
    let firstPage = localStorage.getItem('first-page');
    // let windowCouter = parseInt( localStorage.getItem('tongyu_window_couter') || 0 );
    // localStorage.setItem('tongyu_window_couter', windowCouter + 1);
    console.log(tokenValid);
    if(!tokenValid){
      localStorage.setItem('tongyu_TOKEN_LOCAL_FIELD', '');
      if(!isPageLogin){
        window.location.href = `/#/user/login`;
      }
    }else if(firstPage){
      if (isPageLogin) {
        redirect = firstPage || '/trade-management/booking';
        window.location.href = `/#${redirect}`;
      }
    }
  })();
  window.onbeforeunload = function(){
    localStorage.setItem('last_unload_time', new Date().getTime());
    let windowCouter = parseInt( localStorage.getItem('tongyu_window_couter') || 0 );
    if(windowCouter > 0){
      localStorage.setItem('tongyu_window_couter', windowCouter - 1 );
    }

  }
</script>

</html>
